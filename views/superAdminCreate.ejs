<%- include('./layouts/header'); -%>
<link rel="stylesheet" href="/css/siswaCreate.css" />
<style>
  label{
    font-weight: bold;
  }
</style>
<body>
  <!-- NAV -->
  <%- include('./layouts/navbar'); -%>
  
  <!-- MAIN -->
  <main>
    <%- include('./layouts/superSidebar'); -%>
    <div class="main-content">
      <div class="main-background">
        <div class="main-title">
          <h2>
            Menambahkan Admin Baru
            <span style="color: #ff4c4c; font-size: 0.7rem">*harus diisi</span>
          </h2>
        </div>
        <form id="submit-form">
          <div class="main-input">
            <label for="">Email<span style="color: #ff4c4c"> *</span></label>
            <input
              class="nama-input"
              required
              type="text"
              name="email"
              id=""
              placeholder="Masukan Email Admin"
            />
            <label for="">NUPTK<span style="color: #ff4c4c"> *</span></label>
            <input
              class="nama-input"
              required
              type="number"
              name="nuptk"
              id=""
              placeholder="Masukan NUPTK Admin"
            />

            <label for=""
              >Nama Admin<span style="color: #ff4c4c"> *</span></label
            >
            <input
              class="kelas-input"
              required
              type="text"
              name="username"
              id=""
              placeholder="Masukan Nama Admin"
            />
            <label for=""
              >Jenis Kelamin<span style="color: #ff4c4c"> *</span></label
            >
            <div class="" style="display: flex; gap: 2rem; margin-bottom: .5rem">
              <div>
                <input type="radio" id="" name="gender" value="laki-laki" checked />
                <span style="margin: .5rem;" for="">Laki-Laki</span>
              </div>
            
              <div>
                <input type="radio" id="" name="gender" value="perempuan" />
                <span style="margin: .5rem;" for="">Perempuan</span>
              </div>
            </div>
          </div>
          <div class="submit-input">
            <button type="button" id="selesai">Selesai</button>
          </div>
          <div class="submit-layer">
            <div class="submit-question">
              <img src="/img/warning-alt.png" alt="" width="150" />
              <p>Apakah anda sudah yakin selesai?</p>
              <div class="submit-buttons">
                <button class="ubah-button" type="button">Ubah</button>
                <button class="selesai-button" type="submit">Selesai</button>
              </div>
            </div>
          </div>
        </form>
        <div class="complete-layer">
          <div class="complete-background">
            <img src="/img/check.png" width="50" alt="" />
            <p>Admin berhasil di tambahkan</p>
            <button type="button" id="complete-upload">OK</button>
          </div>
        </div>
      </div>
    </div>
  </main>
</body>
<%- include('./layouts/footer'); -%>
<script>
  $(document).ready(() => {

    let user_id = $("#user_id").text()

    let first_intro = initializeIntro({
    dontShowAgainCookie: "adminCreate_intro",
    dontShowAgain: true,
    dontShowAgainLabel: "Jangan tampilkan lagi",
    tooltipClass: "customTooltip",
    prevLabel: "Kembali",
    nextLabel: "Lanjut",
    doneLabel: "Selesai",
    steps: [
      {
        title: "Tambah Admin",
        intro: "Halaman ini berfungsi untuk menambahkan Admin baru ke dalam tabel",
      },
      {
        element: ".main-input",
        intro: "Super Admin dapat mengisi formulir ini bila ingin menambahkan Admin",
      },
      {
        element: "#selesai",
        intro: "Apabila sudah selesai mengisi formulir dapat langsung menekan tombol selesai",
      },
    ],
  });
  first_intro.start();

    $(".adminSidebar").addClass('selected')
    $("#complete-upload").on("click", function (e) {
      e.preventDefault();
      window.location = "/admin";
    });
    $("#selesai").on("click", () => {
      $(".submit-layer").css("visibility", "visible");
    });

    $(".ubah-button").on("click", () => {
      $(".submit-layer").css("visibility", "hidden");
    });


    // Fetch SUDO
    let school_id
    let school_name
    $.get(`/api/admin/${user_id}`, function(data) {
      school_id = data.payload.datas.school_id
      school_name = data.payload.datas.school_name
    })

    // UPLOAD
    const manualForm = document.getElementById("submit-form");
    manualForm.addEventListener("submit", (e) => {
      e.preventDefault();
      let formData = new FormData(manualForm);
      formData.append("role", "admin");
      formData.append("password", "123");
      formData.append("school_id", school_id)
      formData.append("school_name", school_name)
      $.ajax({
        url: "/api/admin/register",
        type: "POST",
        data: formData,
        async: false,
        cache: false,
        contentType: false,
        encrypt: "multipart/form-data",
        processData: false,
        success: (response) => {
          $(".submit-layer").css("visibility", "hidden");
          if (response.payload.status_code == 201) {
            $(".complete-layer").removeClass("hide");
            $(".complete-layer").css("visibility", "visible");
          } else if (response.payload.message == "you're not authenticated") {
            window.location = "/login";
          }
        },
      });
    });
  });
  function initializeIntro(stepConfig) {
    const intro = introJs();
    intro.setOptions(stepConfig);
    return intro;
  }
  $('form').bind("keypress", function(e) {
        if (e.keyCode == 13) {               
            e.preventDefault();
            return false;
        }
    });
</script>
